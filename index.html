<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walkie Talkie Web</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
<h2>Walkie Talkie</h2>
<p>Seu ID: <span id="meu-id">Conectando...</span></p>
<input type="text" id="id-destino" placeholder="ID do outro usuário">
<button id="btn-conectar">Conectar e Falar</button>

<script>
// Criar conexão com servidor público do PeerJS
var peer = new Peer({
  host: '0.peerjs.com',
  port: 443,
  path: '/',
  secure: true
});

var conn;

peer.on('open', function(id) {
  document.getElementById('meu-id').textContent = id;
});

peer.on('call', function(call) {
  navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
    call.answer(stream);
    call.on('stream', function(remoteStream) {
      var audio = new Audio();
      audio.srcObject = remoteStream;
      audio.play();
    });
  });
});

document.getElementById('btn-conectar').addEventListener('click', function() {
  var idDestino = document.getElementById('id-destino').value;
  if (!idDestino) {
    alert('Digite o ID do outro usuário');
    return;
  }
  navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
    var call = peer.call(idDestino, stream);
    call.on('stream', function(remoteStream) {
      var audio = new Audio();
      audio.srcObject = remoteStream;
      audio.play();
    });
  });
});
</script>
</body>
</html>


